<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>e-Puck: Camera fast two timers</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">e-Puck
   &#160;<span id="projectnumber">107 (SVN revision)</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">Camera fast two timers</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="files"></a>
Files</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="e__calc__po3030k_8c.html">e_calc_po3030k.c</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>Calculate the timing for the camera (two timers) </p>
<br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="e__po3030k_8h.html">e_po3030k.h</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>PO3030k library header (two timers) </p>
<br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="e__po6030k_8h.html">e_po6030k.h</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>PO6030k library header. </p>
<br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="e__timers_8c.html">e_timers.c</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>Manage camera's interrupts (two timers) </p>
<br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="intro_sec"></a>
Introduction</h2>
<p>This driver expose most of the Po3030k camera interfaces. Some functions are usefull, some other not. But since this is not up to the driver to decide if a function is needed, I've exported almost all.</p>
<p>The architecture is quite simple. The driver keep a array where every known camera register is keept in memory. The configuration function only alter this array. When you call, for example <a class="el" href="e__calc__po3030k_8c.html#ad258ffae2f67da9861c6f32c5ebff083">e_po3030k_config_cam()</a>, nothing is written on the camera, but only in the internal register representation.</p>
<p>To effectively write the register, you must call <a class="el" href="e__po3030k_8h.html#a8bf1081d6967491374ec3c6c31b26284">e_po3030k_write_cam_registers()</a>. This is typically done after every configuration call and before acquire the first picture.</p>
<h2><a class="anchor" id="defset"></a>
Default settings</h2>
<p>The camera is, by default, configured with the followin settings:</p>
<ul>
<li>Automatic white balance control</li>
<li>Automatic exposure control</li>
<li>Automatic flicker detection ( 50Hz and 60Hz )</li>
</ul>
<p>There is no default setting for the image size and color.</p>
<h2><a class="anchor" id="perfsec"></a>
Performances</h2>
<p>The maximum framerate ( without doing anything else than acquiring the picture ) vary with the subsampling and the color mode. Here are some framerates:</p>
<ul>
<li>Size: 640x480, Subsampling: 16x16, RGB565: 4.3 fps</li>
<li>Size: 16x480, Subsampling: 16x16, RGB565: 4.3 fps</li>
<li>Size: 480x16, Subsampling: 16x16: RGB565: 4.3fps</li>
<li>Size: 64x64, Subsampling: 4x4, RGB565: 4.3 fps</li>
<li>Size: 32x32, Subsampling: 2x2, RGB565: 2.6 fps</li>
<li>Size: 16x16, No Subsampling, RGB565: 1.3 fps</li>
<li>Size: 640x480, Subsampling: 16x16, GREYSCALE: 8.6 fps</li>
<li>Size: 16x480, Subsampling: 16x16, GREYSCALE: 8.6 fps</li>
<li>Size: 480x16, Subsampling: 16x16, GREYSCALE: 8.6 fps</li>
<li>Size: 64x64, Subsampling: 4x4, GREYSCALE: 8.6 fps</li>
<li>Size: 32x32, Subsampling: 2x2, GREYSCALE: 4.3 fps</li>
<li>Size: 16x16, No subsampling, GREYSCALE: 2.2 fps</li>
</ul>
<h2><a class="anchor" id="IntegrDet"></a>
Important note</h2>
<p>This driver is extremly sensible to interrupt latency, thus it use interrupt priority to be sure that the latencies are kepts low. The Timer4 and Timer5 interrupt priority are set at level 6 and interrupt nesting is enabled. The Timer4 interrupt use the "push.s" and "pop.s" instructions. You should not have any code using thoses two instructions when you use the camera. This include the _ISRFAST C macro. If you use them, some random and really hard to debug behavior will happen. You have been warned !</p>
<h2><a class="anchor" id="example_sect"></a>
Examples</h2>
<h3><a class="anchor" id="ex1_sect"></a>
Basic example</h3>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="e__po3030k_8h.html" title="PO3030k library header (two timers)">e_po3030k.h</a>&quot;</span>

<span class="keywordtype">char</span> buffer[2*40*40];
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {

        <a class="code" href="e__po3030k_8h.html#a84959f62738cb3585e3afbe6555dd2fc">e_po3030k_init_cam</a>();
        <a class="code" href="e__calc__po3030k_8c.html#ad258ffae2f67da9861c6f32c5ebff083">e_po3030k_config_cam</a>((<a class="code" href="e__poxxxx_8h.html#affc622bc6c30b5907a8c0557485e3ecb">ARRAY_WIDTH</a> -160)/2,(<a class="code" href="e__poxxxx_8h.html#ab3bc35eb9567b32302032741a572b7fe">ARRAY_HEIGHT</a>-160)/2,
                         160,160,4,4,<a class="code" href="e__poxxxx_8h.html#ada223bbdb5923e8180a0d6ab252813af">RGB_565_MODE</a>);
        <a class="code" href="e__po3030k_8h.html#a8bf1081d6967491374ec3c6c31b26284">e_po3030k_write_cam_registers</a>();

        e_po3030k_launch_capture(buffer);
        <span class="keywordflow">while</span>(!e_po3030k_is_img_ready());

        <span class="comment">// buffer contain a 40*40 RGB picture now</span>
        ( insert usefull code here )

        <span class="keywordflow">return</span> 0;
}
</pre></div><p>This example tell de driver to aquire 160x160 pixel picture from the camera 4x subsampling, thus resulting with a 40x40 pixel. The buffer as a size of 40*40*2 because RGB565 is a two bytes per pixel data format.</p>
<h3><a class="anchor" id="ex2_sect"></a>
More advanced example</h3>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="e__po3030k_8h.html" title="PO3030k library header (two timers)">e_po3030k.h</a>&quot;</span>

<span class="keywordtype">char</span> buffer[160*2];
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {
        <a class="code" href="e__po3030k_8h.html#a84959f62738cb3585e3afbe6555dd2fc">e_po3030k_init_cam</a>();
        <a class="code" href="e__calc__po3030k_8c.html#ad258ffae2f67da9861c6f32c5ebff083">e_po3030k_config_cam</a>((<a class="code" href="e__poxxxx_8h.html#affc622bc6c30b5907a8c0557485e3ecb">ARRAY_WIDTH</a> - 320)/2,(<a class="code" href="e__poxxxx_8h.html#ab3bc35eb9567b32302032741a572b7fe">ARRAY_HEIGHT</a> - 32)/2,
                        320,8,2,4,<a class="code" href="e__poxxxx_8h.html#aa1b442f912e27d607ee12de718bde738">GREY_SCALE_MODE</a>);
        <a class="code" href="e__po3030k_8h.html#ad2a90327db46451309fc33e040c76b0e">e_po3030k_set_mirror</a>(1,1);
        e_po3030ke_set_ref_exposure(100);

        <a class="code" href="e__po3030k_8h.html#a8bf1081d6967491374ec3c6c31b26284">e_po3030k_write_cam_registers</a>();

        e_po3030k_launch_capture(buffer);
        <span class="keywordflow">while</span>(!e_po3030k_is_img_ready());

        <span class="comment">// Here buffer contain a 160x2 greyscale picture</span>

        <span class="keywordflow">return</span> 0;
}
</pre></div><p> This example configure the camera to aquire a 320x8 pixel picture, but subsampled 2x in width and 4x in heigth, thus resulting in a 160*2 linear greyscale picture. It "emulate" a linear camera. This example tell the camera to to enable the vertical and horizontal mirror, and to set the average exposure to 100.</p>
<h2><a class="anchor" id="intro_sec"></a>
Introduction</h2>
<p>This driver expose the subset features bewteen the po6030k and po3030k camera interfaces. </p>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sat Mar 9 2013 12:13:32 for e-Puck by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
